---
layout: post
title:  How to execute LLVM IR generated from Codon?
date: 2024-07-01 00:00:00
description: Python with native machine speed
tags: thinktank
---

1. Assume we have a python snippet like that:    
```python
# File Name: foo.py
def foo():
    print("Hello World!")
foo()
```
    
2. Convert the code to LLVM IR using Codon:
```bash
codon build -release -llvm foo.py
```

Then we can have the IR code like that:

```llvm
; ModuleID = 'codon'
source_filename = "PATH/foo.py"
target datalayout = "e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-unknown-linux-gnu"

@.str.1 = private unnamed_addr constant [13 x i8] c"Hello World!\00"
@.str.3 = private unnamed_addr constant [2 x i8] c"\0A\00"

; Function Attrs: nounwind
declare ptr @seq_stdout() local_unnamed_addr #0

; Function Attrs: nounwind
declare {} @seq_print_full({ i64, ptr }, ptr) local_unnamed_addr #0

declare i32 @seq_personality(i32, i32, i64, ptr, ptr)

declare void @seq_init(i32) local_unnamed_addr

define i32 @main(i32 %argc, ptr nocapture readonly %argv) local_unnamed_addr personality ptr @seq_personality {
entry:
  tail call void @seq_init(i32 4)
  %0 = tail call ptr @seq_stdout()
  %1 = tail call {} @seq_print_full({ i64, ptr } { i64 12, ptr @.str.1 }, ptr %0)
  %2 = tail call {} @seq_print_full({ i64, ptr } { i64 1, ptr @.str.3 }, ptr %0)
  ret i32 0
}

attributes #0 = { nounwind }

!llvm.module.flags = !{!0}

!0 = !{i32 2, !"Debug Info Version", i32 3}
```
    
**3. Compile Codon runtime (you need to install and setup CMake in advance):**
```bash
# Clone Codon Repo
git clone https://github.com/exaloop/codon.git

# Create a build dir
mkdir build
cd build

# Compile the Codon runtime
cmake ..
make
```
    
4. Execute the generated IR using ‘lli’ with Codon runtime libcodonrt.so):
```bash
lli -load ./codon/build/libcodonrt.so ./foo.ll 
```



